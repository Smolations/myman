BEGIN {
    # all tokens/tags should be placed here for easy modification
    gsmStart = "^[[:blank:]]*##[[:blank:]]*\\/\\*"
    gsmStop = "^[[:blank:]]*##[[:blank:]]*\\*\\/"

    # tagStart = "(^|[[:blank:]]*)@[[:alnum:]]+"
    tagStart = "(^[[:blank:]]*)@[[:alnum:]]+"
    tagStop = "(^|[[:blank:]]*)[[:alnum:]]+@"

    tagColor = "\033[36m"   #cyan
    tagX = "\033[0;20;39m"  #reset styles
}

# the opening tag: ## /*
$0 ~ gsmStart {
    # print type descriptor
    dMatch = match( $0, /@[[:alnum:]]+/ )
    print "type:" substr( $0, RSTART + 1, RLENGTH - 1 )

    i = 2
    tagStartPos = 1
    do {
        # process the rest of the lines
        getline ln
        # print "ln=" ln

        # print name descriptor (from @usage string)
        if (i == 2) {
            if ( match(ln, /@usage/) > 0 ) {
                tagStartPos = RSTART
                usageString = substr( ln, RSTART + RLENGTH + 1 )
                split( usageString, usagePieces, / / )
                print "name:" usagePieces[1] ":" tagStartPos

            } else {
                match( ln, "#" )
                tagStartPos = RSTART + 1
                print "name:"
            }
        }

        # loop through lines of the file until the closing
        # comment is found
        mtch = match( ln, gsmStop )
        if ( mtch == 0 ) {
            data = tagX substr( ln, tagStartPos )
            # print "(" tagStartPos ")"

            # color open tags
            print "matching|" data "|"
3            if ( match(data, tagStart) > 0 ) {
                print " \`- MATCH"
                tagText = substr( data, RSTART, RLENGTH )
                newText = tagColor " " tagText " " tagX     #include spaces so next gsub doesnt yield unexpected results
                gsub( tagText, newText, data )
            }

            # closing tags don't actually need to be displayed
            if ( match(data, tagStop) > 0 ) {
                tagText = substr( data, RSTART, RLENGTH )
                gsub( tagText, "", data )
            }

            # print tagX data
        }

        i++
    } while( mtch == 0 )
}
